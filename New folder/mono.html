<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mono Tinnitus Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .controls label {
      display: block;
      margin: 10px 0 5px;
    }
    .controls input[type="range"] {
      width: 100%;
    }
    .waveform-buttons button {
      margin-right: 5px;
      padding: 5px 10px;
    }
    .waveform-buttons .active {
      background: #3498db;
      color: white;
    }
    #playButton {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    canvas {
      width: 100%;
      height: 100px;
      background: #fff;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Mono Tinnitus Generator</h1>
  <div class="container">
    <div class="controls">
      <label>Output Ear:</label>
      <select id="earSelect">
        <option value="left">Left Ear</option>
        <option value="right">Right Ear</option>
      </select>

      <label>Frequency: <span id="freqVal">1000</span> Hz</label>
      <input type="range" id="frequency" min="20" max="20000" value="1000" step="1">

      <label>Phase: <span id="phaseVal">0</span>Â°</label>
      <input type="range" id="phase" min="0" max="360" value="0" step="1">

      <label>Waveform:</label>
      <div class="waveform-buttons">
        <button class="waveform-btn active" data-waveform="sine">Sine</button>
        <button class="waveform-btn" data-waveform="square">Square</button>
        <button class="waveform-btn" data-waveform="sawtooth">Saw</button>
      </div>

      <canvas id="waveCanvas"></canvas>
      <button id="playButton">Play</button>
    </div>
  </div>

  <script>
    class MonoTinnitusGenerator {
      constructor() {
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.oscillator = null;
        this.gainNode = this.audioContext.createGain();
        this.panner = this.audioContext.createStereoPanner();
        this.gainNode.connect(this.panner).connect(this.audioContext.destination);

        this.frequency = 1000;
        this.phase = 0;
        this.waveform = 'sine';
        this.ear = 'left';
        this.isPlaying = false;

        this.initElements();
        this.addListeners();
        this.setupCanvas();
        this.drawWave();
      }

      initElements() {
        this.freqSlider = document.getElementById('frequency');
        this.freqVal = document.getElementById('freqVal');
        this.phaseSlider = document.getElementById('phase');
        this.phaseVal = document.getElementById('phaseVal');
        this.waveBtns = document.querySelectorAll('.waveform-btn');
        this.playBtn = document.getElementById('playButton');
        this.earSelect = document.getElementById('earSelect');
        this.canvas = document.getElementById('waveCanvas');
        this.ctx = this.canvas.getContext('2d');
      }

      addListeners() {
        this.freqSlider.oninput = () => {
          this.frequency = +this.freqSlider.value;
          this.freqVal.textContent = this.frequency;
          if (this.oscillator) {
            this.oscillator.frequency.setValueAtTime(this.frequency, this.audioContext.currentTime);
          }
          this.drawWave();
        };

        this.phaseSlider.oninput = () => {
          this.phase = +this.phaseSlider.value;
          this.phaseVal.textContent = this.phase;
          this.drawWave();
        };

        this.earSelect.onchange = () => {
          this.ear = this.earSelect.value;
          if (this.panner) {
            this.panner.pan.setValueAtTime(this.ear === 'left' ? -1 : 1, this.audioContext.currentTime);
          }
        };

        this.waveBtns.forEach(btn => {
          btn.onclick = () => {
            this.waveform = btn.dataset.waveform;
            this.waveBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (this.oscillator) {
              this.oscillator.type = this.waveform;
            }
            this.drawWave();
          };
        });

        this.playBtn.onclick = () => this.togglePlayback();

        window.addEventListener('resize', () => {
          this.setupCanvas();
          this.drawWave();
        });
      }

      setupCanvas() {
        this.canvas.width = this.canvas.offsetWidth;
        this.canvas.height = this.canvas.offsetHeight;
      }

      togglePlayback() {
        if (this.isPlaying) {
          this.stop();
        } else {
          this.play();
        }
      }

      play() {
        const offset = this.phase / 360 / this.frequency;
        this.oscillator = this.audioContext.createOscillator();
        this.oscillator.type = this.waveform;
        this.oscillator.frequency.value = this.frequency;

        this.panner.pan.setValueAtTime(this.ear === 'left' ? -1 : 1, this.audioContext.currentTime);
        this.oscillator.connect(this.gainNode);
        this.oscillator.start(this.audioContext.currentTime + offset);

        this.isPlaying = true;
        this.playBtn.textContent = 'Stop';
      }

      stop() {
        if (this.oscillator) {
          this.oscillator.stop();
          this.oscillator.disconnect();
          this.oscillator = null;
        }
        this.isPlaying = false;
        this.playBtn.textContent = 'Play';
      }

      drawWave() {
        const ctx = this.ctx;
        const width = ctx.canvas.width;
        const height = ctx.canvas.height;
        ctx.clearRect(0, 0, width, height);
        ctx.beginPath();
        for (let x = 0; x < width; x++) {
          const t = x / width;
          const angle = 2 * Math.PI * this.frequency * t + this.phase * Math.PI / 180;
          const y = Math.sin(angle);
          const yPixel = height / 2 - y * height / 2;
          x === 0 ? ctx.moveTo(x, yPixel) : ctx.lineTo(x, yPixel);
        }
        ctx.strokeStyle = '#3498db';
        ctx.lineWidth = 2;
        ctx.stroke();
      }
    }

    new MonoTinnitusGenerator();
  </script>
</body>
</html>
